{% extends 'AppBundle:Layout:base.html.twig' %}

{% block title %}Reports | Gateways{% endblock %}

{% block stylesheets %}
{% endblock stylesheets %}

{% block pageTitle -%} Payment Gateway {%- endblock pageTitle %}

{% block breadcrumb -%}
    <li>{{ "breadcrumb.report"|trans({},"AppBundle") }}</li>
    <li class="active">{{ "breadcrumb.paymentGateway"|trans({},"AppBundle") }}</li>
{%- endblock breadcrumb %}

{% block pageHeaderExtra %}
<div class="pull-right report">
    <ul class="list-inline quicklinks font-13 font-normal text-right">
        {% if is_granted(['ROLE_REPORT_PRODUCT_VIEW', 'ROLE_REPORT_CUSTOMER_VIEW']) %}
        <li>Quick Links:</li>
        {% endif %}
        {% if is_granted('ROLE_REPORT_CUSTOMER_VIEW') %} 
        <li><a href="{{ path("report.customers") }}"> {{ "menus.report.member"|trans({},"ReportBundle") }} </a></li>|
        {% endif %}
        {% if is_granted('ROLE_REPORT_PRODUCT_VIEW') %} 
        <li><a href="{{ path("report.products") }}"> {{ "menus.report.product"|trans({},"ReportBundle") }}</a></li>
        {% endif %}
    </ul>
</div>
{% endblock pageHeaderExtra %}

{% block page %}
    <div class="col-sm-12 report-notes-wrap">
        <div class="report-notes">
            <p>{{ "notes.reportNotes"|trans({},"ReportBundle") }}</p>
        </div>
    </div>
    <div class="col-md-12">
        <div class="card-box">
            <div class="form form-inline m-l-10 m-b-5" id="reportFilter">
                <div class="form-group form-group-sm m-r-10 ft-date">
                    <div class="m-t-10 xs-date">
                        <div class="form-group form-group-sm m-r-10">
                            <label>{{ "fields.labels.from"|trans({},"ReportBundle") }}</label>
                            <div class="input-group">
                                <input class="form-control cls-date" name="from" id="dateFrom" type="input" />
                                <span class="input-group-addon bg-white text-default"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>
                        <div class="form-group form-group-sm">
                            <label>{{ "fields.labels.to"|trans({},"ReportBundle") }}</label>
                            <div class="input-group">
                                <input class="form-control cls-date" name="to" id="dateTo" type="input" />
                                <span class="input-group-addon bg-white text-default"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>
                        <div class="form-group form-group-sm m-r-10">
                            <label>{{ "fields.labels.currency"|trans({},"ReportBundle") }}</label>
                            <select
                                id="currency"
                                class="form-control selectpicker"
                                name="currencies"
                                data-style="btn-white btn-sm"
                                multiple="multiple"
                                data-none-selected-text="Select Currency"
                                data-width="auto"
                                data-container="body">
                                {% for currency  in currencies %}
                                    <option value="{{ currency.code }}">{{ currency.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <button id="btnFilter" class="form-group btn btn-default btn-sm" type="button">
                    Filter
                </button>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        {% for currency in currencies %}
        <div class="reportContainer card-box hide" id="container{{ currency.code }}">
            <h5 class="text-muted text-uppercase m-t-0 m-b-20"><b>Currency: {{ currency.name }}</b></h5>
            <div class="report" id="report{{ currency.code }}">
                <table
                    class="table table-striped table-bordered dt-responsive nowrap"
                    cellspacing="0"
                    width="100%">
                    <thead>
                        <tr>
                            <th>Payment Gateway</th>
                            <th># of Deposits</th>
                            <th># of Withdraws</th>
                            <th>Total Deposit</th>
                            <th>Total Withdraw</th>
                            <th>Total Company Fee</th>
                            <th>Total Member Fee</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                        <tr>
                            <th>Total</th>
                            <th>0</th>
                            <th>0</th>
                            <th>0.00</th>
                            <th>0.00</th>
                            <th>0.00</th>
                            <th>0.00</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
{% endblock page %}

{% block javascripts %}
    <script src="{{ asset('bundles/app/js/ZTable.js') }}"></script>
    <script src="{{ asset('bundles/report/js/GatewayReport.js') }}"></script>
    <script type="text/javascript">
    </script>
    <script type="text/javascript">
        var reports = {};

        $(function () {
            $('#dateTo').datepicker();
            $('#dateFrom').datepicker();
        });

        // Ztables
        $(function () {
            {% for currency in currencies -%}
                reports['{{ currency.code }}'] = new GatewayReport(
                    '#report{{ currency.code }}',
                    '{{ currency.code }}',
                    '{{ path('report.gateway_currency', {'currency': currency.code}) }}',
                    '{{ path('report.gateways_export', {'currencyCode': currency.code}) }}'
                );
            {%- endfor %}

            $('#btnFilter').click(function (e) {
                var from = $('#dateFrom').val();
                var to = $('#dateTo').val();
                $('.reportContainer').addClass('hide');
                $.each($('#currency option:selected'), function () {
                    $('#container' + $(this).val()).removeClass('hide');
                    reports[$(this).val()].filter(from, to);
                });
                $('.report-notes-wrap').fadeOut();

                $('.selectpicker').selectpicker();
            });
        });
    </script>
{% endblock javascripts %}
