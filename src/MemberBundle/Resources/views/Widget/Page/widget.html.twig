{% use "AppBundle:Widget:base.html.twig"  %}

{% block memberProductRequest_widget %}
    <div class="filters" id="{{ id }}_list">
        <table id="{{ id }}_table" class="table table-striped table-bordered dt-responsive nowrap" width="100%">
            <thead>
            <tr>
                <th>Product</th>
                <th>Username</th>
                <th>Member</th>
                <th>Date Requested</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
{% endblock memberProductRequest_widget %}

{% block memberProductRequest_assetjs %}
    {{ asset_render('js', 'default', [asset('bundles/app/js/ZTable.js')]) }}
{% endblock memberProductRequest_assetjs %}

{% block memberProductRequest_javascript %}
    <script type="text/javascript">
        $(function () {
            var {{ id }}_list = new ZTable('#{{ id }}_list', {
                'dom': "t",
                'ajax': {
                    'headers': {
                        'X-WIDGET-REQUEST': 'onGetMemberProductRequestList',
                        'X-WIDGET-PATH': '{{ widget_path }}',
                        'X-WIDGET-ID': '{{ id }}'
                    },
                    'dataFilter': function (str) {
                        return str;
                    },
                    'dataSrc': '',
                },
                'columns': [
                    {
                        'data': 'product.name',
                    },
                    {
                        'data': 'user_name'
                    },
                    {
                        'data': 'customer.full_name',
                    },
                    {
                        'data': 'requested_at',
                        'render': function(data) {
                            return moment(data).format('MMM D, YYYY hh:mm a');
                        }
                    }
                ],
                'dt': {
                    'processing': true,
                    'serverSide': false,
                    'deferLoading': null,
                    'paginate': false,
                    'paging': false,
                    'bPaginate': false,
                    'bInfo': false,
                    'initComplete': function (settings, json) {
                        if (json.length === 0) {
                            $('#{{ id }}_list .dataTables_empty').attr('tabindex', 0);
                        }
                    }
                }
            });

            $('#{{ id }}_container .zTable-refresh').click(function(){
                {{ id }}_list.dataTable.api().ajax.reload();
            });
        });
    </script>
{% endblock memberProductRequest_javascript %}